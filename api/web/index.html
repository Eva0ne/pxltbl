<html>
<head>
    <script
            src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
            integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
            crossorigin="anonymous"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>

        var socket = io(document.location.href);
        socket.on('connect', function(){
            $('#log').text('Connected: ');
        });
        socket.on('leds', function(data){

            var int8View = new Uint8Array(data);
            var pixels = $('#display li').toArray();

            $('#display li').each(function(index, pixel){
                $(pixel).css('background-color','rgba('+int8View[index*3]+','+int8View[index*3+1]+','+int8View[index*3+2]+',1)');
            });

        });

        socket.on('debug', function(data){

            if(typeof data == 'object') {
                data = 'Debug: '+JSON.stringify(data);
            }
            $('#console').append('<p class="debug">'+data+'</p>');
            $('#console').scrollTop($('#console')[0].scrollHeight);

        });

        socket.on('frameData', function(data){

            $('#log').text(JSON.stringify(data));


        });

        socket.on('error', function(data){

            if(typeof data == 'object') {
                data = 'Error: '+JSON.stringify(data);
            }
            $('#console').append('<p class="error">'+data+'</p>');

            $('#console').scrollTop($('#console')[0].scrollHeight);

        });


        socket.on('disconnect', function(){
            $('#log').text('Disconnected');

        });

        var pxlW = 23;
        var pxlH = 11;

        $(function() {

            //init LEDs
            for (var y = 0; y < pxlH; y++) {
                $('#display').append($('<ul>'));
                for (var x = 0; x < pxlW; x++) {
                    $('#display ul').last().append($('<li data-x="'+x+'" data-y="'+y+'" data-i="'+ ((y*pxlW)+x) +'">'));
                }

            }
            $('#display').append($('<br style="clear: left"/>'));

            $('#pxlTbl button').mousedown(function(){
                socket.emit('buttonDown',$(this).data('cmd'));
            });

            $('#pxlTbl button').mouseup(function(){
                socket.emit('buttonUp',$(this).data('cmd'));
            });

            $('#display li').mouseenter(function(e){

                if(e.which == 1) {
                    var data = $(this).data('i');
                    socket.emit('touchDown', data);
                }
            });
            $('#display li').mousedown(function(e){

                var data = $(this).data('i');
                socket.emit('touchDown',data);
            });

            $('#display li').mouseleave(function(e){

                var data = $(this).data('i');
                socket.emit('touchUp',data);
            });
            $('#display li').mouseup(function(e){

                var data = $(this).data('i');
                socket.emit('touchUp',data);
            });


            $('body').keydown(function(e) {
                e.preventDefault();
                switch (e.which) {
                    case 32:
                        socket.emit('buttonDown','fire');
                        break;
                    case 37:
                        socket.emit('buttonDown','left');
                        break;
                    case 38:
                        socket.emit('buttonDown','up');
                        break;
                    case 39:
                        socket.emit('buttonDown','right');
                        break;
                    case 40:
                        socket.emit('buttonDown','down');
                        break;
                    case 27:
                        socket.emit('buttonDown','home');
                        break;
                }

            });

            $('body').keyup(function(e) {
                e.preventDefault();
                switch (e.which) {
                    case 32:
                        socket.emit('buttonUp','fire');
                        break;
                    case 37:
                        socket.emit('buttonUp','left');
                        break;
                    case 38:
                        socket.emit('buttonUp','up');
                        break;
                    case 39:
                        socket.emit('buttonUp','right');
                        break;
                    case 40:
                        socket.emit('buttonUp','down');
                        break;
                    case 27:
                        socket.emit('buttonUp','home');
                        break;
                }

            });


        });
    </script>

    <style type="text/css">

        body {
            background-color: #333;
            color:#eee;
            font-family: sans-serif;
        }

        #console {
            width:50%;
            height: 22vw;

            font-family: "Lucida Console";
            background: #555;
            color:#eee;
            overflow-y: scroll;
            padding: 10px 0;
        }

        #console p {
            padding:0 10px;
            margin: 0;
        }

        #console .error {
            color: #ff8888;
        }

        #pxlTbl {
            background: peru;
            border-radius: 50px;

            margin: 50px auto;
            position: relative;
            padding: 90px;
            float: left;


        }



        #pxlTbl button {
            position: absolute;
            border-radius: 100%;

            width:50px;
            height: 50px;
            margin: 20px;

        }


        #display {

            padding: 20px;
            background: #000;
            border-radius: 20px;

        }

        #display ul {
            list-style:none;
            margin:0;
            padding:0;
            width:100%;
            clear:left;

        }

        #display li {
            list-style:none;
            margin:1px;
            padding:0;
            float:left;
            width:30px;
            height:30px;
            background-color:#fff;


        }







    </style>
</head>
<body>

<div id="pxlTbl">
        <button data-cmd="topLeft" style="top:0; left:100px;"></button>
        <button data-cmd="topRight" style="top:0; right: 100px;"></button>

        <button data-cmd="leftTop" style="left:0; top:100px;"></button>
        <button data-cmd="leftBottom" style="left:0; bottom:100px;"></button>

        <div id="display"></div>

        <button data-cmd="rightTop" style="top:100px; right:0;"></button>
        <button data-cmd="rightBottom" style="right:0; bottom:100px;"></button>

        <button data-cmd="bottomLeft" style="bottom:0; left:100px;"></button>
        <button data-cmd="bottomRight" style="bottom:0; right:100px;"></button>

    <button data-cmd="home" style="bottom:0; left:50%; margin-left: -25px;">Home</button>


</div>
<br style="clear:both;"/>

<div id="console">
    <p>Hello.</p>
</div>
<br style="clear:both;"/>
<div id="buttons">



</div>
<div id="log">Waiting...</div>
</body>
</html>